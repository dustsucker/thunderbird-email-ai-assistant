{
  "file_path": "src/infrastructure/interfaces/IReviewQueueRepository.ts",
  "main_branch_history": [],
  "task_views": {
    "003-confidence-score-display-and-threshold-configurati": {
      "task_id": "003-confidence-score-display-and-threshold-configurati",
      "branch_point": {
        "commit_hash": "f6a57e8f6ff34822855d2c5f711f425bd9bc6897",
        "content": "",
        "timestamp": "2026-01-05T14:48:03.044500"
      },
      "worktree_state": {
        "content": "/**\n * Repository interface for managing manual review queue.\n *\n * Provides methods for storing and retrieving email classifications\n * that fall below confidence thresholds and require manual review.\n */\n\n/**\n * Review status for items in the queue.\n */\nexport type ReviewStatus = 'pending' | 'approved' | 'rejected' | 'ignored';\n\n/**\n * Review queue item representing a low-confidence classification.\n *\n * Stores information about tags that fell below the confidence threshold\n * and need manual user review before being applied.\n */\nexport interface IReviewQueueItem {\n  /** Unique identifier for this review item */\n  id: string;\n  /** Thunderbird message ID that was analyzed */\n  messageId: string;\n  /** Email subject for identification */\n  subject: string;\n  /** Sender email address */\n  from: string;\n  /** Analysis timestamp (ISO 8601 string) */\n  timestamp: string;\n  /** Provider that performed the analysis */\n  provider: string;\n  /** Model used for analysis */\n  model: string;\n  /** Overall confidence score (0-100) */\n  confidenceScore: number;\n  /** Tags that were suggested but fell below threshold */\n  manualReviewTags: Array<{\n    /** Tag key */\n    tag: string;\n    /** Confidence score for this tag (0-100) */\n    confidence: number;\n    /** Threshold that was not met (0-100) */\n    threshold: number;\n  }>;\n  /** AI reasoning for the classification */\n  reasoning: string;\n  /** Current review status */\n  status: ReviewStatus;\n  /** When this item was added to the queue (ISO 8601 string) */\n  addedAt: string;\n  /** When this item was reviewed (ISO 8601 string), if reviewed */\n  reviewedAt?: string;\n  /** Optional notes from reviewer */\n  reviewNotes?: string;\n  /** Cache key for the original analysis */\n  cacheKey?: string;\n}\n\n/**\n * Query options for filtering review queue.\n */\nexport interface IReviewQueueQuery {\n  /** Filter by message ID */\n  messageId?: string;\n  /** Filter by review status */\n  status?: ReviewStatus;\n  /** Filter by provider */\n  provider?: string;\n  /** Filter by minimum confidence score (0-100) */\n  minConfidenceScore?: number;\n  /** Filter by maximum confidence score (0-100) */\n  maxConfidenceScore?: number;\n  /** Filter by tag key (returns items that have this tag in manualReviewTags) */\n  hasTag?: string;\n  /** Filter by date range start (ISO 8601 string) */\n  startDate?: string;\n  /** Filter by date range end (ISO 8601 string) */\n  endDate?: string;\n  /** Maximum number of records to return */\n  limit?: number;\n  /** Number of records to skip for pagination */\n  offset?: number;\n}\n\n/**\n * Review queue statistics summary.\n */\nexport interface IReviewQueueStats {\n  /** Total number of items in queue */\n  totalItems: number;\n  /** Number of pending items */\n  pendingCount: number;\n  /** Number of approved items */\n  approvedCount: number;\n  /** Number of rejected items */\n  rejectedCount: number;\n  /** Number of ignored items */\n  ignoredCount: number;\n  /** Average confidence score of pending items (0-100) */\n  averagePendingConfidence: number;\n  /** Most commonly queued tags with counts */\n  topTags: Array<{ tag: string; count: number }>;\n}\n\n/**\n * Repository interface for review queue persistence.\n *\n * Provides CRUD operations and querying capabilities for the manual review queue.\n * Uses browser.storage.local for persistent storage.\n */\nexport interface IReviewQueueRepository {\n  /**\n   * Adds an item to the review queue.\n   *\n   * @param item - Review queue item to add\n   * @throws Error if add operation fails\n   */\n  addToQueue(item: IReviewQueueItem): Promise<void>;\n\n  /**\n   * Gets a specific review queue item by ID.\n   *\n   * @param id - Review queue item ID\n   * @returns Review queue item or null if not found\n   * @throws Error if retrieval fails\n   */\n  getItem(id: string): Promise<IReviewQueueItem | null>;\n\n  /**\n   * Gets all review queue items for a specific message.\n   *\n   * @param messageId - Thunderbird message ID\n   * @returns Array of review queue items (empty if none found)\n   * @throws Error if retrieval fails\n   */\n  getItemsByMessage(messageId: string): Promise<IReviewQueueItem[]>;\n\n  /**\n   * Queries review queue with filters.\n   *\n   * @param query - Query options for filtering\n   * @returns Array of matching review queue items\n   * @throws Error if query fails\n   */\n  queryQueue(query?: IReviewQueueQuery): Promise<IReviewQueueItem[]>;\n\n  /**\n   * Updates the status of a review queue item.\n   *\n   * @param id - Review queue item ID\n   * @param status - New review status\n   * @param reviewNotes - Optional reviewer notes\n   * @throws Error if update fails\n   */\n  updateStatus(id: string, status: ReviewStatus, reviewNotes?: string): Promise<void>;\n\n  /**\n   * Gets statistics about the review queue.\n   *\n   * @param query - Optional query to filter stats calculation\n   * @returns Review queue statistics\n   * @throws Error if stats calculation fails\n   */\n  getStats(query?: IReviewQueueQuery): Promise<IReviewQueueStats>;\n\n  /**\n   * Deletes a specific review queue item.\n   *\n   * @param id - Review queue item ID to delete\n   * @throws Error if deletion fails\n   */\n  deleteItem(id: string): Promise<void>;\n\n  /**\n   * Deletes all review queue items for a specific message.\n   *\n   * @param messageId - Thunderbird message ID\n   * @returns Number of items deleted\n   * @throws Error if deletion fails\n   */\n  deleteItemsByMessage(messageId: string): Promise<number>;\n\n  /**\n   * Clears all items from the review queue.\n   *\n   * This will remove all review queue items permanently.\n   * Use with caution.\n   *\n   * @returns Number of items deleted\n   * @throws Error if clear operation fails\n   */\n  clearAll(): Promise<number>;\n\n  /**\n   * Gets total count of review queue items.\n   *\n   * @param query - Optional query to filter count\n   * @returns Number of matching items\n   * @throws Error if count fails\n   */\n  count(query?: IReviewQueueQuery): Promise<number>;\n}\n",
        "last_modified": "2026-01-05T19:59:00.207567"
      },
      "task_intent": {
        "title": "Confidence Score Display and Threshold Configuration",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-05T14:48:03.107411",
  "last_updated": "2026-01-05T14:48:03.111179"
}