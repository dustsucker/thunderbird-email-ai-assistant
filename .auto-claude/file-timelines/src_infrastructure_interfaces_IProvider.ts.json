{
  "file_path": "src/infrastructure/interfaces/IProvider.ts",
  "main_branch_history": [],
  "task_views": {
    "003-confidence-score-display-and-threshold-configurati": {
      "task_id": "003-confidence-score-display-and-threshold-configurati",
      "branch_point": {
        "commit_hash": "f6a57e8f6ff34822855d2c5f711f425bd9bc6897",
        "content": "/**\n * Provider interfaces for the Thunderbird Email AI Assistant.\n *\n * Defines the contract for AI providers that analyze emails and assign tags.\n * This interface bridges the legacy BaseProvider implementation with the new\n * dependency injection architecture.\n */\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\n/**\n * Provider settings interface.\n *\n * Extensible settings object for AI provider configuration.\n * Specific providers can add custom properties.\n */\nexport interface IProviderSettings {\n  /** API authentication key */\n  apiKey?: string;\n  /** API endpoint URL */\n  apiUrl?: string;\n  /** Model identifier for the AI service */\n  model?: string;\n  /** Additional provider-specific settings */\n  [key: string]: unknown;\n}\n\n/**\n * Email attachment metadata.\n */\nexport interface IAttachment {\n  /** Original filename */\n  name: string;\n  /** MIME type of the attachment */\n  mimeType: string;\n  /** File size in bytes */\n  size: number;\n}\n\n/**\n * Structured email data for AI analysis.\n *\n * Contains parsed email content with headers, body text, and attachment metadata.\n */\nexport interface IStructuredEmailData {\n  /** Email headers as key-value pairs */\n  headers: Record<string, string>;\n  /** Plain text body content */\n  body: string;\n  /** List of email attachments */\n  attachments: IAttachment[];\n}\n\n/**\n * Custom tag configuration.\n *\n * Defines a custom tag that can be applied to emails by the AI analysis.\n */\nexport interface ICustomTag {\n  /** Unique tag identifier */\n  key: string;\n  /** Human-readable tag name */\n  name: string;\n  /** Description for the AI model */\n  description: string;\n}\n\n/**\n * AI analysis response with assigned tags.\n *\n * Result of email analysis containing tags, confidence score, and reasoning.\n */\nexport interface ITagResponse {\n  /** List of tag keys that apply to this email */\n  tags: string[];\n  /** Overall confidence score (0.0 to 1.0) */\n  confidence: number;\n  /** AI reasoning for the tag assignment */\n  reasoning: string;\n  /** Whether the email appears to be a scam */\n  is_scam?: boolean;\n  /** Detected sender name */\n  sender?: string;\n  /** Whether sender is consistent with headers */\n  sender_consistent?: boolean | null;\n  /** SPF authentication result */\n  spf_pass?: boolean | null;\n  /** DKIM authentication result */\n  dkim_pass?: boolean | null;\n  /** Additional provider-specific response data */\n  [key: string]: unknown;\n}\n\n/**\n * Input for email analysis.\n *\n * Combines provider settings, email data, and custom tag configurations.\n */\nexport interface IAnalyzeInput {\n  /** Provider configuration settings */\n  settings: IProviderSettings;\n  /** Structured email data to analyze */\n  data: IStructuredEmailData;\n  /** Custom tag configurations for analysis */\n  tags: ICustomTag[];\n  /** AbortSignal for cancelling the analysis */\n  signal?: AbortSignal;\n}\n\n// ============================================================================\n// Main Provider Interface\n// ============================================================================\n\n/**\n * AI Provider interface.\n *\n * Defines the contract for AI providers that analyze emails and assign tags.\n * Implementations should handle communication with external AI services,\n * retry logic, error handling, and response validation.\n *\n * @example\n * ```typescript\n * const provider: IProvider = container.resolve<IProvider>('Provider');\n * const isValid = await provider.validateSettings({ apiKey: 'sk-...' });\n * if (isValid) {\n *   const result = await provider.analyze({\n *     settings: { apiKey: 'sk-...', model: 'gpt-4' },\n *     data: { headers: {}, body: '...', attachments: [] },\n *     tags: [{ key: 'is_advertise', name: 'Ad', description: '...' }]\n *   });\n *   console.log(result.tags);\n * }\n * ```\n */\nexport interface IProvider {\n  /**\n   * Validates provider settings.\n   *\n   * Checks that required settings (API key, model, etc.) are present and valid.\n   *\n   * @param settings - Provider settings to validate\n   * @returns Promise resolving to true if settings are valid\n   *\n   * @throws {Error} If settings validation fails (implementation-specific)\n   */\n  validateSettings(settings: IProviderSettings): Promise<boolean>;\n\n  /**\n   * Analyzes an email and assigns tags.\n   *\n   * Main entry point for email analysis. Sends email data to the AI provider\n   * and returns a structured response with assigned tags and metadata.\n   *\n   * @param input - Analysis input containing settings, email data, and tags\n   * @returns Promise resolving to tag analysis response\n   *\n   * @throws {Error} If analysis fails (invalid settings, API error, timeout, etc.)\n   */\n  analyze(input: IAnalyzeInput): Promise<ITagResponse>;\n\n  /**\n   * Lists available models for this provider.\n   * Optional - providers without model selection should return empty array.\n   *\n   * @param settings - Provider settings (API key, etc.)\n   * @returns Promise resolving to array of available model names\n   */\n  listModels?(settings: IProviderSettings): Promise<string[]>;\n\n  /**\n   * Unique provider identifier.\n   *\n   * Used for provider registration and dependency injection resolution.\n   * Should be a stable identifier that uniquely identifies the provider type.\n   *\n   * @example\n   * ```typescript\n   * console.log(provider.providerId); // \"openai\" or \"ollama\" or \"claude\"\n   * ```\n   */\n  readonly providerId: string;\n}\n",
        "timestamp": "2026-01-05T14:48:03.044500"
      },
      "worktree_state": {
        "content": "/**\n * Provider interfaces for the Thunderbird Email AI Assistant.\n *\n * Defines the contract for AI providers that analyze emails and assign tags.\n * This interface bridges the legacy BaseProvider implementation with the new\n * dependency injection architecture.\n */\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\n/**\n * Provider settings interface.\n *\n * Extensible settings object for AI provider configuration.\n * Specific providers can add custom properties.\n */\nexport interface IProviderSettings {\n  /** API authentication key */\n  apiKey?: string;\n  /** API endpoint URL */\n  apiUrl?: string;\n  /** Model identifier for the AI service */\n  model?: string;\n  /** Additional provider-specific settings */\n  [key: string]: unknown;\n}\n\n/**\n * Email attachment metadata.\n */\nexport interface IAttachment {\n  /** Original filename */\n  name: string;\n  /** MIME type of the attachment */\n  mimeType: string;\n  /** File size in bytes */\n  size: number;\n}\n\n/**\n * Structured email data for AI analysis.\n *\n * Contains parsed email content with headers, body text, and attachment metadata.\n */\nexport interface IStructuredEmailData {\n  /** Email headers as key-value pairs */\n  headers: Record<string, string>;\n  /** Plain text body content */\n  body: string;\n  /** List of email attachments */\n  attachments: IAttachment[];\n}\n\n/**\n * Custom tag configuration.\n *\n * Defines a custom tag that can be applied to emails by the AI analysis.\n */\nexport interface ICustomTag {\n  /** Unique tag identifier */\n  key: string;\n  /** Human-readable tag name */\n  name: string;\n  /** Description for the AI model */\n  description: string;\n}\n\n/**\n * AI analysis response with assigned tags.\n *\n * Result of email analysis containing tags, confidence score, and reasoning.\n */\nexport interface ITagResponse {\n  /** List of tag keys that apply to this email */\n  tags: string[];\n  /** Overall confidence score (0.0 to 1.0) - raw provider value */\n  confidence: number;\n  /**\n   * Confidence score on 0-100 scale (user-friendly)\n   *\n   * Normalized from the raw confidence value for easier user understanding.\n   * Calculated as: Math.round(confidence * 100)\n   *\n   * @example\n   * confidence: 0.85, confidence_score: 85\n   */\n  confidence_score: number;\n  /** AI reasoning for the tag assignment */\n  reasoning: string;\n  /** Whether the email appears to be a scam */\n  is_scam?: boolean;\n  /** Detected sender name */\n  sender?: string;\n  /** Whether sender is consistent with headers */\n  sender_consistent?: boolean | null;\n  /** SPF authentication result */\n  spf_pass?: boolean | null;\n  /** DKIM authentication result */\n  dkim_pass?: boolean | null;\n  /** Additional provider-specific response data */\n  [key: string]: unknown;\n}\n\n/**\n * Input for email analysis.\n *\n * Combines provider settings, email data, and custom tag configurations.\n */\nexport interface IAnalyzeInput {\n  /** Provider configuration settings */\n  settings: IProviderSettings;\n  /** Structured email data to analyze */\n  data: IStructuredEmailData;\n  /** Custom tag configurations for analysis */\n  tags: ICustomTag[];\n  /** AbortSignal for cancelling the analysis */\n  signal?: AbortSignal;\n}\n\n// ============================================================================\n// Main Provider Interface\n// ============================================================================\n\n/**\n * AI Provider interface.\n *\n * Defines the contract for AI providers that analyze emails and assign tags.\n * Implementations should handle communication with external AI services,\n * retry logic, error handling, and response validation.\n *\n * @example\n * ```typescript\n * const provider: IProvider = container.resolve<IProvider>('Provider');\n * const isValid = await provider.validateSettings({ apiKey: 'sk-...' });\n * if (isValid) {\n *   const result = await provider.analyze({\n *     settings: { apiKey: 'sk-...', model: 'gpt-4' },\n *     data: { headers: {}, body: '...', attachments: [] },\n *     tags: [{ key: 'is_advertise', name: 'Ad', description: '...' }]\n *   });\n *   console.log(result.tags);\n * }\n * ```\n */\nexport interface IProvider {\n  /**\n   * Validates provider settings.\n   *\n   * Checks that required settings (API key, model, etc.) are present and valid.\n   *\n   * @param settings - Provider settings to validate\n   * @returns Promise resolving to true if settings are valid\n   *\n   * @throws {Error} If settings validation fails (implementation-specific)\n   */\n  validateSettings(settings: IProviderSettings): Promise<boolean>;\n\n  /**\n   * Analyzes an email and assigns tags.\n   *\n   * Main entry point for email analysis. Sends email data to the AI provider\n   * and returns a structured response with assigned tags and metadata.\n   *\n   * @param input - Analysis input containing settings, email data, and tags\n   * @returns Promise resolving to tag analysis response\n   *\n   * @throws {Error} If analysis fails (invalid settings, API error, timeout, etc.)\n   */\n  analyze(input: IAnalyzeInput): Promise<ITagResponse>;\n\n  /**\n   * Lists available models for this provider.\n   * Optional - providers without model selection should return empty array.\n   *\n   * @param settings - Provider settings (API key, etc.)\n   * @returns Promise resolving to array of available model names\n   */\n  listModels?(settings: IProviderSettings): Promise<string[]>;\n\n  /**\n   * Unique provider identifier.\n   *\n   * Used for provider registration and dependency injection resolution.\n   * Should be a stable identifier that uniquely identifies the provider type.\n   *\n   * @example\n   * ```typescript\n   * console.log(provider.providerId); // \"openai\" or \"ollama\" or \"claude\"\n   * ```\n   */\n  readonly providerId: string;\n}\n",
        "last_modified": "2026-01-05T19:59:00.207220"
      },
      "task_intent": {
        "title": "Confidence Score Display and Threshold Configuration",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2026-01-05T14:48:03.115686",
  "last_updated": "2026-01-05T14:48:03.118837"
}